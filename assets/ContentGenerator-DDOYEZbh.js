import{h as o,R as p,x as $,N as D,T as B,M as P,U as G,q as e,C as b,Q as E}from"./index-2IpbhVEU.js";import{T as F}from"./Textarea-gaIhsF-Z.js";import{I as T}from"./Input-CRT_4c0B.js";import{M as H,S as _}from"./MediaActionsToolbar-DcojfTTc.js";import{s as J}from"./firestoreService-BE71X2i2.js";import"./useMediaActions-DZ7A1mgc.js";const X=()=>{const[r,k]=o.useState(""),[t,N]=o.useState(null),[d,y]=o.useState(p),[l,c]=o.useState(!1),[w,g]=o.useState(!1),[u,S]=o.useState(""),[j,I]=o.useState(""),{addToast:s}=$(),h="mock-user-123",f=o.useCallback(async(a=!1)=>{if(!r.trim()){s({type:"warning",title:"Atenção",message:"Por favor, insira um prompt para gerar conteúdo."});return}c(!0),g(!0),N(null),y(p),S(""),I("");try{let n=`Generate a compelling social media post for: "${r}".`;a?n=`Generate 7 unique social media post ideas (including text and image descriptions for each) for a weekly content plan based on: "${r}". Format as a JSON array of objects with 'text' and 'image_description' keys.`:n=`Generate a compelling social media post (text only) for: "${r}". Include relevant hashtags.`;const i=await D(n,{model:B});let m="",x="",v=[];if(a)try{v=JSON.parse(i),v.length>0?(m=v[0].text,x=v[0].image_description||r):(m="No weekly posts generated in JSON format. Here's the raw response: "+i,x=r)}catch(U){console.warn("Failed to parse weekly posts as JSON, using raw text.",U),m=i,x=r}else m=i,x=`An image illustrating the post content: "${m.substring(0,100)}..."`;c(!1);const C=await P(x,{model:G});y(C.imageUrl||p),g(!1);const R={id:`post-${Date.now()}`,userId:h,content_text:m,image_url:C.imageUrl||void 0,createdAt:new Date().toISOString()};N(R),s({type:"success",title:"Conteúdo Gerado",message:"Texto e imagem foram gerados com sucesso."})}catch(n){console.error("Error generating content:",n),s({type:"error",title:"Erro na Geração",message:`Falha: ${n instanceof Error?n.message:String(n)}`}),c(!1),g(!1)}},[r,h,s]),L=o.useCallback(()=>f(!1),[f]),A=o.useCallback(()=>f(!0),[f]),M=o.useCallback(async()=>{if(!t){s({type:"error",message:"Por favor gere um post primeiro."});return}g(!0);try{const a=`An alternative image for: "${t.content_text.substring(0,100)}..."`,n=await P(a,{model:G});if(y(n.imageUrl||p),t){const i={...t,image_url:n.imageUrl||void 0};N(i)}s({type:"success",message:"Imagem regenerada com sucesso."})}catch(a){console.error("Error regenerating image:",a),s({type:"error",title:"Erro",message:"Falha ao regenerar imagem."})}finally{g(!1)}},[t,s]),O=o.useCallback(async()=>{if(!t){s({type:"warning",message:"Nenhum post para salvar."});return}c(!0);try{const a=await J(t);s({type:"success",title:"Salvo na Biblioteca",message:`Post "${a.content_text.substring(0,20)}..." salvo com sucesso!`})}catch(a){console.error("Error saving post:",a),s({type:"error",title:"Erro ao Salvar",message:"Não foi possível salvar o post na biblioteca."})}finally{c(!1)}},[t,s]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Content Generator"}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Gerar Novo Conteúdo"}),e.jsx(F,{id:"contentPrompt",label:"Descreva o conteúdo que você deseja gerar:",value:r,onChange:a=>k(a.target.value),rows:6,placeholder:"Ex: 'Um post sobre os benefícios da meditação para o bem-estar mental', ou 'Ideias para 7 posts semanais sobre dicas de produtividade no trabalho.'"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(b,{onClick:L,isLoading:l&&!t,variant:"primary",className:"w-full sm:w-auto",children:l&&!t?"Gerando Post...":"Gerar 1 Post"}),e.jsx(b,{onClick:A,isLoading:l&&!t&&r.includes("semanal"),variant:"secondary",className:"w-full sm:w-auto",children:l&&!t&&r.includes("semanal")?"Gerando Semana...":"Gerar Semana"})]})]}),t&&e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 animate-slide-in-from-bottom duration-500",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Conteúdo Gerado"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Texto do Post"}),l&&!t.content_text?e.jsx(E,{}):e.jsx("div",{className:"prose max-w-none text-textlight leading-relaxed bg-darkbg p-4 rounded-md h-full min-h-[150px]",style:{whiteSpace:"pre-wrap"},children:t.content_text})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Imagem do Post"}),w?e.jsx("div",{className:"flex items-center justify-center h-48 bg-gray-900 rounded-md",children:e.jsx(E,{})}):e.jsx("img",{src:d,alt:"Generated content visual",className:"w-full h-48 object-contain rounded-md border border-gray-700 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(b,{onClick:M,isLoading:w,variant:"outline",className:"w-full sm:w-auto",children:w?"Regenerando...":"Regenerar Imagem"}),e.jsx(H,{mediaUrl:d,fileName:"vitrinex-post.png",shareTitle:"Confira este post!",shareText:t.content_text})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-800",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-4",children:"Salvar na Biblioteca"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(T,{id:"saveName",label:"Nome do Item",value:u,onChange:a=>S(a.target.value),placeholder:"Ex: Post Campanha Verão"}),e.jsx(T,{id:"saveTags",label:"Tags (separadas por vírgula)",value:j,onChange:a=>I(a.target.value),placeholder:"Ex: instagram, verão, promoção"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(b,{onClick:O,variant:"primary",isLoading:l,disabled:!t,className:"w-full sm:w-auto",children:l?"Salvando Post Completo...":"Salvar Post Completo"}),e.jsx(_,{content:d,type:"image",userId:h,initialName:u||"Imagem Gerada",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Imagem",variant:"secondary",disabled:!d||d===p,className:"w-full sm:w-auto"}),e.jsx(_,{content:t.content_text,type:"text",userId:h,initialName:u?`${u} (Texto)`:"Texto do Post",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Texto",variant:"outline",className:"w-full sm:w-auto"})]})]})]})]})};export{X as default};
