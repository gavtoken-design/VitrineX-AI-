import{h as n,x as k,L as G,W as L,X as U,q as e,C as j,R as A,N as D,Y as S,Z as P,M as O,_,Q as B}from"./index-2IpbhVEU.js";import{T as M}from"./Textarea-gaIhsF-Z.js";import{I as E}from"./Input-CRT_4c0B.js";import{M as F,S as $}from"./MediaActionsToolbar-DcojfTTc.js";import{F as q}from"./SpeakerWaveIcon-_A4BRNIH.js";import{a as V}from"./firestoreService-BE71X2i2.js";import"./useMediaActions-DZ7A1mgc.js";const z=({text:m})=>{const[w,p]=n.useState(!1),[h,i]=n.useState(null),{addToast:b}=k(),o=n.useRef(null);n.useEffect(()=>()=>{h&&URL.revokeObjectURL(h)},[h]);const N=s=>{const r=s.numberOfChannels,g=s.length*r*2+44,f=new ArrayBuffer(g),l=new DataView(f);let d=0;const x=c=>{l.setUint16(d,c,!0),d+=2},t=c=>{l.setUint32(d,c,!0),d+=4};t(1179011410),t(36+s.length*2*r),t(1163280727),t(544501094),t(16),x(1),x(r),t(s.sampleRate),t(s.sampleRate*2*r),x(r*2),x(16),t(1635017060),t(s.length*2*r);let v=44;for(let c=0;c<s.length;c++)for(let y=0;y<r;y++){const a=Math.max(-1,Math.min(1,s.getChannelData(y)[c]));l.setInt16(v,a<0?a*32768:a*32767,!0),v+=2}return new Blob([l],{type:"audio/wav"})},u=n.useCallback(async()=>{if(m){p(!0),i(null);try{const s=await G(m,"Kore");if(!s)throw new Error("Nenhum áudio foi gerado.");const r=L(s),g=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),f=await U(r,g,24e3,1),l=N(f),d=URL.createObjectURL(l);i(d),b({type:"success",message:"Narração gerada."})}catch(s){console.error("Voiceover generation failed:",s),b({type:"error",message:`Falha ao gerar narração: ${s instanceof Error?s.message:"Erro desconhecido"}`})}finally{p(!1)}}},[m,b]);return e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[e.jsxs(j,{onClick:u,isLoading:w,variant:"outline",size:"sm",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Gerar Narração"]}),h&&!w&&e.jsx("audio",{ref:o,controls:!0,src:h,className:"w-full mt-3 h-10"})]})},J=["Instagram","Facebook","TikTok","Google","Pinterest"],ee=()=>{const[m,w]=n.useState(""),[p,h]=n.useState(""),[i,b]=n.useState("Instagram"),[o,N]=n.useState(null),[u,s]=n.useState(A),[r,g]=n.useState(!1),[f,l]=n.useState(""),[d,x]=n.useState(""),{addToast:t}=k(),v="mock-user-123",c=n.useCallback(async()=>{if(!m.trim()||!p.trim()){t({type:"warning",title:"Campos Vazios",message:"Por favor, preencha a descrição e o público-alvo."});return}g(!0),N(null),s(A),l(""),x("");try{const a=`Generate a compelling ad for ${i}.
      Product: "${m}".
      Target Audience: "${p}".
      Provide a headline, ad copy, and a visual description for an image/video creative.
      Return the output as a JSON object with 'headline', 'copy', and 'visual_description' keys.`,R=await D(a,{model:P,responseMimeType:"application/json",responseSchema:{type:S.OBJECT,properties:{headline:{type:S.STRING},copy:{type:S.STRING},visual_description:{type:S.STRING}},required:["headline","copy","visual_description"]}}),C=JSON.parse(R),T={id:`ad-${Date.now()}`,userId:v,platform:i,headline:C.headline,copy:C.copy,createdAt:new Date().toISOString()};N(T);const I=await O(C.visual_description,{model:_,aspectRatio:"1:1",imageSize:"1K"});s(I.imageUrl||A),T.media_url=I.imageUrl||void 0,t({type:"success",title:"Anúncio Criado",message:"Anúncio gerado com sucesso."})}catch(a){console.error("Error generating ad:",a),t({type:"error",title:"Erro",message:`Falha ao gerar anúncio: ${a instanceof Error?a.message:String(a)}`})}finally{g(!1)}},[m,p,i,v,t]),y=n.useCallback(async()=>{if(!o){t({type:"warning",message:"Nenhum anúncio para salvar."});return}g(!0);try{const a=await V(o);t({type:"success",title:"Salvo",message:`Anúncio para "${a.platform}" salvo com sucesso!`})}catch(a){console.error("Error saving ad:",a),t({type:"error",title:"Erro ao Salvar",message:"Falha ao salvar o anúncio."})}finally{g(!1)}},[o,t]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Estúdio de Anúncios"}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Detalhes do Anúncio"}),e.jsx(M,{id:"productDescription",label:"Descrição do Produto/Serviço:",value:m,onChange:a=>w(a.target.value),rows:4,placeholder:"Ex: 'Um novo software de gestão de projetos com IA para pequenas e médias empresas que otimiza tarefas e comunicação.'"}),e.jsx(E,{id:"targetAudience",label:"Público-alvo:",value:p,onChange:a=>h(a.target.value),placeholder:"Ex: 'Empreendedores, gerentes de equipe, freelancers que buscam eficiência.'"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"platform",className:"block text-sm font-medium text-textlight mb-1",children:"Plataforma:"}),e.jsx("select",{id:"platform",value:i,onChange:a=>b(a.target.value),className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm",children:J.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(j,{onClick:c,isLoading:r&&!o,variant:"primary",className:"w-full md:w-auto mt-4",children:r&&!o?"Gerando Anúncio...":"Gerar Anúncio"})]}),o&&e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 animate-slide-in-from-bottom duration-500",children:[e.jsxs("h3",{className:"text-xl font-semibold text-textlight mb-5",children:["Anúncio Gerado para ",o.platform]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Título:"}),e.jsx("p",{className:"text-textdark text-xl font-medium mb-4",children:o.headline}),e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Texto:"}),e.jsx("div",{className:"prose max-w-none text-textlight leading-relaxed bg-darkbg p-4 rounded-md h-auto min-h-[150px]",style:{whiteSpace:"pre-wrap"},children:o.copy}),e.jsx(z,{text:o.copy}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(j,{variant:"secondary",onClick:()=>t({type:"info",message:"Funcionalidade em desenvolvimento."}),children:"Gerar Variações"}),e.jsx(j,{variant:"outline",onClick:()=>t({type:"info",message:"Funcionalidade em desenvolvimento."}),children:"Editar"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Criativo Visual:"}),e.jsx("div",{className:"w-full aspect-square bg-gray-900 rounded-md flex items-center justify-center overflow-hidden border border-gray-700",children:r&&!u?e.jsx(B,{}):e.jsx("img",{src:u,alt:"Generated ad creative",className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(F,{mediaUrl:u,fileName:`vitrinex-ad-${i}.png`,shareTitle:`Confira este anúncio para ${i}!`,shareText:o.copy}),e.jsx(j,{onClick:y,variant:"primary",isLoading:r,disabled:!o,className:"w-full sm:w-auto",children:r&&o?"Salvando Anúncio...":"Salvar Anúncio"})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-800",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-4",children:"Salvar Criativo na Biblioteca"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(E,{id:"adSaveName",label:"Nome do Arquivo",value:f,onChange:a=>l(a.target.value),placeholder:"Ex: Anúncio Black Friday"}),e.jsx(E,{id:"adSaveTags",label:"Tags",value:d,onChange:a=>x(a.target.value),placeholder:"Ex: ad, instagram, black friday"})]}),e.jsx($,{content:u,type:"image",userId:v,initialName:f||`Anúncio ${o.platform}`,tags:d.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Criativo (Imagem)",variant:"secondary",disabled:!u||u===A,className:"w-full sm:w-auto"})]})]})]})};export{ee as default};
