import{S as r,L as p,J as F,H as B,M as D,G,N as I,_ as e,b as v,t as _}from"./index-Di1jv5f6.js";import{m as M}from"./Textarea-gaIhsF-Z-OB2gT--i.js";import{n as P}from"./Input-CRT_4c0B-CcXoGhNA.js";import{M as R,D as $}from"./MediaActionsToolbar-DcojfTTc-4KYaUHh3.js";import{c as q}from"./firestoreService-BE71X2i2-C74a6-GV.js";import"./useMediaActions-DZ7A1mgc-VCjv--Wh.js";const W=()=>{const[o,E]=r.useState(""),[t,N]=r.useState(null),[c,y]=r.useState(p),[n,d]=r.useState(!1),[w,g]=r.useState(!1),[u,S]=r.useState(""),[j,C]=r.useState(""),{addToast:s}=F(),h="mock-user-123",f=r.useCallback(async(a=!1)=>{if(!o.trim()){s({type:"warning",title:"Atenção",message:"Por favor, insira um prompt para gerar conteúdo."});return}d(!0),g(!0),N(null),y(p),S(""),C("");try{let l=`Generate a compelling social media post for: "${o}".`;a?l=`Generate 7 unique social media post ideas (including text and image descriptions for each) for a weekly content plan based on: "${o}". Format as a JSON array of objects with 'text' and 'image_description' keys.`:l=`Generate a compelling social media post (text only) for: "${o}". Include relevant hashtags.`;const i=await B(l,{model:D});let m="",x="",b=[];if(a)try{b=JSON.parse(i),b.length>0?(m=b[0].text,x=b[0].image_description||o):(m="No weekly posts generated in JSON format. Here's the raw response: "+i,x=o)}catch(O){console.warn("Failed to parse weekly posts as JSON, using raw text.",O),m=i,x=o}else m=i,x=`An image illustrating the post content: "${m.substring(0,100)}..."`;d(!1);const k=await G(x,{model:I});y(k.imageUrl||p),g(!1);const L={id:`post-${Date.now()}`,userId:h,content_text:m,image_url:k.imageUrl||void 0,createdAt:new Date().toISOString()};N(L),s({type:"success",title:"Conteúdo Gerado",message:"Texto e imagem foram gerados com sucesso."})}catch(l){console.error("Error generating content:",l),s({type:"error",title:"Erro na Geração",message:`Falha: ${l instanceof Error?l.message:String(l)}`}),d(!1),g(!1)}},[o,h,s]),T=r.useCallback(()=>f(!1),[f]),A=r.useCallback(()=>f(!0),[f]),U=r.useCallback(async()=>{if(!t){s({type:"error",message:"Por favor gere um post primeiro."});return}g(!0);try{const a=`An alternative image for: "${t.content_text.substring(0,100)}..."`,l=await G(a,{model:I});if(y(l.imageUrl||p),t){const i={...t,image_url:l.imageUrl||void 0};N(i)}s({type:"success",message:"Imagem regenerada com sucesso."})}catch(a){console.error("Error regenerating image:",a),s({type:"error",title:"Erro",message:"Falha ao regenerar imagem."})}finally{g(!1)}},[t,s]),J=r.useCallback(async()=>{if(!t){s({type:"warning",message:"Nenhum post para salvar."});return}d(!0);try{const a=await q(t);s({type:"success",title:"Salvo na Biblioteca",message:`Post "${a.content_text.substring(0,20)}..." salvo com sucesso!`})}catch(a){console.error("Error saving post:",a),s({type:"error",title:"Erro ao Salvar",message:"Não foi possível salvar o post na biblioteca."})}finally{d(!1)}},[t,s]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Content Generator"}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Gerar Novo Conteúdo"}),e.jsx(M,{id:"contentPrompt",label:"Descreva o conteúdo que você deseja gerar:",value:o,onChange:a=>E(a.target.value),rows:6,placeholder:"Ex: 'Um post sobre os benefícios da meditação para o bem-estar mental', ou 'Ideias para 7 posts semanais sobre dicas de produtividade no trabalho.'"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(v,{onClick:T,isLoading:n&&!t,variant:"primary",className:"w-full sm:w-auto",children:n&&!t?"Gerando Post...":"Gerar 1 Post"}),e.jsx(v,{onClick:A,isLoading:n&&!t&&o.includes("semanal"),variant:"secondary",className:"w-full sm:w-auto",children:n&&!t&&o.includes("semanal")?"Gerando Semana...":"Gerar Semana"})]})]}),t&&e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 animate-slide-in-from-bottom duration-500",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Conteúdo Gerado"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Texto do Post"}),n&&!t.content_text?e.jsx(_,{}):e.jsx("div",{className:"prose max-w-none text-textlight leading-relaxed bg-darkbg p-4 rounded-md h-full min-h-[150px]",style:{whiteSpace:"pre-wrap"},children:t.content_text})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Imagem do Post"}),w?e.jsx("div",{className:"flex items-center justify-center h-48 bg-gray-900 rounded-md",children:e.jsx(_,{})}):e.jsx("img",{src:c,alt:"Generated content visual",className:"w-full h-48 object-contain rounded-md border border-gray-700 mb-4"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(v,{onClick:U,isLoading:w,variant:"outline",className:"w-full sm:w-auto",children:w?"Regenerando...":"Regenerar Imagem"}),e.jsx(R,{mediaUrl:c,fileName:"vitrinex-post.png",shareTitle:"Confira este post!",shareText:t.content_text})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-800",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-4",children:"Salvar na Biblioteca"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(P,{id:"saveName",label:"Nome do Item",value:u,onChange:a=>S(a.target.value),placeholder:"Ex: Post Campanha Verão"}),e.jsx(P,{id:"saveTags",label:"Tags (separadas por vírgula)",value:j,onChange:a=>C(a.target.value),placeholder:"Ex: instagram, verão, promoção"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(v,{onClick:J,variant:"primary",isLoading:n,disabled:!t,className:"w-full sm:w-auto",children:n?"Salvando Post Completo...":"Salvar Post Completo"}),e.jsx($,{content:c,type:"image",userId:h,initialName:u||"Imagem Gerada",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Imagem",variant:"secondary",disabled:!c||c===p,className:"w-full sm:w-auto"}),e.jsx($,{content:t.content_text,type:"text",userId:h,initialName:u?`${u} (Texto)`:"Texto do Post",tags:j.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Texto",variant:"outline",className:"w-full sm:w-auto"})]})]})]})]})};export{W as default};
