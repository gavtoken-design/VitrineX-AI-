import{S as s,z as D,J as W,aj as P,ak as U,ai as V,al as J,_ as e,am as R,b as o,t as S,an as H,a as K,ac as M,ag as X,l as O,ao as Q,ad as Y,ap as Z}from"./index-Di1jv5f6.js";import{g as ee,p as ae}from"./useMediaActions-DZ7A1mgc-VCjv--Wh.js";import{n as te}from"./Input-CRT_4c0B-CcXoGhNA.js";const le=()=>{const[f,x]=s.useState([]),[q,b]=s.useState(!0),[g,y]=s.useState(""),[d,v]=s.useState("all"),[j,w]=s.useState(!1),[I,N]=s.useState(!1),[n,F]=s.useState(localStorage.getItem("vitrinex_kb_name")),{navigateTo:h}=D(),{addToast:t}=W(),{handleDownload:_,handleShare:C,isProcessing:k}=ee(),m="mock-user-123",u=s.useCallback(async a=>{b(!0);try{const r=await P(m,a);x(r)}catch(r){console.error("Failed to fetch library items:",r),t({type:"error",title:"Erro",message:"Falha ao carregar biblioteca."})}finally{b(!1)}},[m,t]);s.useEffect(()=>{u()},[]);const $=async()=>{N(!0);try{const a=await Z(`VitrineX KB - ${new Date().toLocaleDateString()}`);a&&a.storeName&&(localStorage.setItem("vitrinex_kb_name",a.storeName),F(a.storeName),t({type:"success",title:"Base Criada",message:"Base de Conhecimento criada! Você já pode indexar arquivos."}))}catch(a){console.error(a),t({type:"error",title:"Erro",message:"Erro ao criar base de conhecimento. Verifique sua chave API."})}finally{N(!1)}},B=s.useCallback(async a=>{var r;const i=(r=a.target.files)==null?void 0:r[0];if(i){w(!0);try{let l;i.type.startsWith("image")?l="image":i.type.startsWith("video")?l="video":i.type.startsWith("audio")?l="audio":l="text";const c=await ae(i,m,l);if(n&&(l==="text"||i.type==="application/pdf"||i.type.startsWith("application/vnd.openxmlformats"))&&window.confirm(`Deseja indexar "${i.name}" na sua Base de Conhecimento para pesquisa?`))try{await U(i,{}),t({type:"success",title:"Indexado",message:"Arquivo indexado na IA com sucesso!"}),c.tags.push("indexed")}catch(p){console.error("Indexing failed",p),t({type:"warning",title:"Parcial",message:"Upload concluído, mas falha ao indexar na IA."})}await V(c),x(p=>[c,...p]),t({type:"success",message:"Arquivo enviado com sucesso!"})}catch(l){const c=`Falha: ${l instanceof Error?l.message:String(l)}`;t({type:"error",title:"Erro no Upload",message:c})}finally{w(!1),a.target.value=""}}},[m,n,t]),E=s.useCallback(async a=>{if(window.confirm("Tem certeza que deseja excluir este item?"))try{await J(a),x(r=>r.filter(i=>i.id!==a)),t({type:"success",message:"Item excluído."})}catch(r){console.error("Error deleting item:",r),t({type:"error",message:"Falha ao excluir item."})}},[t]),T=s.useCallback(a=>{if(a.type!=="image"&&a.type!=="video"){t({type:"warning",message:"Apenas imagens e vídeos podem ser compartilhados."});return}C(a.file_url,a.name,`Confira este arquivo da minha biblioteca: ${a.name}`)},[t,C]);s.useCallback(a=>{h("SmartScheduler"),t({type:"info",message:`Item "${a.name}" pronto para agendar.`})},[h,t]);const z=Array.from(new Set(f.flatMap(a=>a.tags))),A=f.filter(a=>a.name.toLowerCase().includes(g.toLowerCase())).filter(a=>d==="all"||a.tags.includes(d)),L=g.trim()!==""||d!=="all",G=s.useCallback(()=>{y(""),v("all"),u()},[u]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Biblioteca de Conteúdo"}),e.jsxs("div",{className:"bg-gradient-to-r from-gray-900 to-gray-800 p-6 rounded-lg shadow-md border border-gray-700 mb-8 flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[e.jsx(R,{className:"w-6 h-6 text-accent"})," Base de Conhecimento (IA)"]}),e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:n?`Conectado a: ${n}. Arquivos enviados podem ser pesquisados pelo Chatbot.`:"Crie um repositório para indexar seus arquivos e permitir que a IA responda com base neles."})]}),e.jsx("div",{children:n?e.jsx("span",{className:"text-xs font-mono bg-black/30 px-3 py-1 rounded text-accent border border-accent/20",children:"Status: Ativo"}):e.jsx(o,{onClick:$,isLoading:I,variant:"secondary",children:"Criar Base de Conhecimento"})})]}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Gerenciar Conteúdo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(te,{id:"searchContent",type:"text",placeholder:"Buscar por nome...",value:g,onChange:a=>y(a.target.value),className:"col-span-1 md:col-span-2"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tagFilter",className:"sr-only",children:"Filtrar por Tag"}),e.jsxs("select",{id:"tagFilter",value:d,onChange:a=>v(a.target.value),className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm",children:[e.jsx("option",{value:"all",children:"Todas as Tags"}),z.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("label",{htmlFor:"file-upload-input",className:`cursor-pointer inline-flex items-center justify-center px-5 py-2 text-base font-semibold rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition duration-200 ease-in-out w-full sm:w-auto
              ${j?"opacity-60 cursor-not-allowed bg-accent text-darkbg":"bg-accent text-darkbg shadow-lg shadow-accent/50 hover:bg-neonGreen/80 focus:ring-neonGreen focus:ring-offset-lightbg"}`,children:[j?e.jsx(S,{}):"Enviar Arquivo",e.jsx("input",{id:"file-upload-input",type:"file",onChange:B,className:"hidden"})]}),L&&e.jsx(o,{variant:"primary",onClick:G,className:"w-full sm:w-auto",children:"Limpar Filtros"})]})]}),q?e.jsxs("div",{className:"flex justify-center items-center h-48",children:[e.jsx(S,{}),e.jsx("p",{className:"ml-2 text-textlight",children:"Carregando biblioteca..."})]}):A.length===0?e.jsx("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 text-center text-textlight",children:"Nenhum item encontrado na biblioteca."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6",children:A.map(a=>e.jsxs("div",{className:"bg-lightbg rounded-lg shadow-sm border border-gray-800 overflow-hidden group",children:[e.jsxs("div",{className:"relative h-48 bg-gray-900 flex items-center justify-center overflow-hidden",children:[a.type==="image"||a.type==="video"?e.jsx("img",{src:a.thumbnail_url||a.file_url||"https://picsum.photos/200/150",alt:a.name,className:"w-full h-full object-cover"}):a.type==="audio"?e.jsxs("div",{className:"text-gray-500 text-center p-4",children:[e.jsx(H,{className:"w-12 h-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-textlight",children:"Arquivo de Áudio"})]}):e.jsxs("div",{className:"text-gray-500 text-center p-4",children:[e.jsx(K,{className:"w-12 h-12 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-sm text-textlight",children:"Arquivo de Texto"})]}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 gap-2",children:[e.jsx(o,{onClick:()=>_(a.file_url,a.name),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Baixar",disabled:k,children:e.jsx(M,{className:"w-5 h-5 text-accent"})}),e.jsx(o,{onClick:()=>T(a),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Compartilhar",disabled:k,children:e.jsx(X,{className:"w-5 h-5 text-accent"})}),e.jsx(o,{onClick:()=>h("SmartScheduler"),variant:"ghost",size:"sm",className:"text-white hover:bg-primary/20",title:"Usar no Calendário",children:e.jsx(O,{className:"w-5 h-5 text-accent"})}),e.jsx(o,{onClick:()=>E(a.id),variant:"danger",size:"sm",className:"text-white hover:bg-red-700",title:"Excluir",children:e.jsx(Q,{className:"w-5 h-5 text-red-400"})})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h4",{className:"font-semibold text-textdark truncate flex-1",children:a.name}),a.tags.includes("indexed")&&e.jsx(Y,{className:"w-4 h-4 text-accent",title:"Indexado na IA"})]}),e.jsxs("p",{className:"text-sm text-textmuted mt-1",children:["Tipo: ",a.type]}),a.tags.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.tags.map(r=>e.jsx("span",{className:"bg-darkbg text-textlight text-xs px-2 py-1 rounded-full",children:r},r))})]})]},a.id))})]})};export{le as default};
