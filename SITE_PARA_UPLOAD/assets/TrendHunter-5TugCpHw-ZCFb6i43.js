import{S as r,z as W,J as X,f as Y,a1 as ee,a2 as ae,H as se,M as re,_ as e,a3 as te,t as ne,b as x,a4 as le}from"./index-Di1jv5f6.js";import{n as ie}from"./Input-CRT_4c0B-CcXoGhNA.js";function oe({title:o,titleId:g,...n},p){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:p,"aria-labelledby":g},n),o?r.createElement("title",{id:g},o):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))}const _=r.forwardRef(oe),me=()=>{const[o,g]=r.useState(""),[n,p]=r.useState(""),[S,w]=r.useState([]),[$,E]=r.useState(!1),[I,N]=r.useState(null),[de,F]=r.useState(null),[u,b]=r.useState("pending"),[A,k]=r.useState({}),[R,B]=r.useState(null),{navigateTo:h}=W(),{addToast:l}=X(),{language:f}=Y(),T="mock-user-123",C=r.useCallback(()=>{b("pending"),navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{F({latitude:a.coords.latitude,longitude:a.coords.longitude}),b("success")},a=>{console.warn("Geolocation access denied or failed:",a),b("denied")},{enableHighAccuracy:!1,timeout:5e3,maximumAge:0}):b("denied")},[]);r.useEffect(()=>{C()},[C]);const z=r.useCallback(async()=>{if(!o.trim()){l({type:"warning",message:"Por favor, insira um termo de busca para tendências."});return}E(!0),N(null),w([]),k({});try{let a=o;n.trim()&&(a+=` em ${n}`);const s=(await ee(a,f)).map(i=>({...i,userId:T}));w(s);for(const i of s)await ae(i);l({type:"success",message:`${s.length} tendências encontradas e salvas!`})}catch(a){const s=`Falha ao buscar tendências: ${a instanceof Error?a.message:String(a)}`;N(s),l({type:"error",title:"Erro na Busca",message:s})}finally{E(!1)}},[o,n,T,l,f]),D=r.useCallback(async a=>{B(a.id);try{const s=f==="pt-BR"?`Com base no tópico em alta "${a.query}" e nos seguintes detalhes: "${a.data}", sugira uma ideia de conteúdo criativa e envolvente (por exemplo, um conceito de post para rede social ou título de blog). Mantenha a sugestão concisa e em português.`:`Based on the trending topic "${a.query}" and the following details: "${a.data}", suggest a creative and engaging content idea (e.g., a social media post concept or blog title). Keep it concise.`,i=await se(s,{model:re});k(y=>({...y,[a.id]:i}))}catch(s){console.error("Error generating idea:",s),l({type:"error",title:"Erro",message:"Falha ao gerar ideia de conteúdo."})}finally{B(null)}},[l,f]),H=r.useCallback(a=>{h("ContentGenerator"),l({type:"info",message:`Criando conteúdo baseado na tendência: ${a.query}`})},[h,l]),O=r.useCallback(a=>{h("SmartScheduler"),l({type:"info",message:`Adicionando tendência "${a.query}" ao calendário.`})},[h,l]),Z=o.trim()||n.trim(),J=r.useCallback(()=>{g(""),p(""),w([]),k({}),N(null)},[]),K=(a,s)=>{var i,y;if(!(s!=null&&s.groundingSupports)||!(s!=null&&s.groundingChunks)||s.groundingSupports.length===0)return e.jsx("p",{className:"text-body leading-relaxed whitespace-pre-wrap",children:a});const Q=s.groundingSupports,L=s.groundingChunks;let v=a;const U=[...Q].sort((d,m)=>{var c,t;return(((c=m.segment)==null?void 0:c.endIndex)??0)-(((t=d.segment)==null?void 0:t.endIndex)??0)});for(const d of U){const m=(i=d.segment)==null?void 0:i.endIndex;if(m===void 0||!((y=d.groundingChunkIndices)!=null&&y.length))continue;const c=d.groundingChunkIndices.map(t=>{var j,G,M,P;const q=((G=(j=L[t])==null?void 0:j.web)==null?void 0:G.uri)||((P=(M=L[t])==null?void 0:M.maps)==null?void 0:P.uri);return q?`[${t+1}](${q})`:null}).filter(Boolean);if(c.length>0){const t=" "+c.join("");v=v.slice(0,m)+t+v.slice(m)}}const V=v.split(/(\[\d+\]\(.+?\))/g);return e.jsx("p",{className:"text-body leading-relaxed whitespace-pre-wrap",children:V.map((d,m)=>{const c=d.match(/\[(\d+)\]\((.+?)\)/);if(c){const[,t,j]=c;return e.jsx("a",{href:j,target:"_blank",rel:"noopener noreferrer",className:"inline-block align-baseline text-xs bg-primary/10 text-primary font-bold px-1.5 py-0.5 rounded-md mx-0.5 hover:bg-primary/20 hover:underline",title:`Ir para fonte ${t}`,children:t},m)}return d})})};return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-title mb-8",children:"Caçador de Tendências"}),I&&e.jsxs("div",{className:"bg-red-900 border border-red-600 text-red-300 px-4 py-3 rounded relative mb-8",role:"alert",children:[e.jsx("strong",{className:"font-bold",children:"Erro!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",I]})]}),e.jsxs("div",{className:"bg-surface p-6 rounded-xl shadow-card border border-gray-100 dark:border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-title mb-5 flex justify-between items-center",children:"Buscar Tendências"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(ie,{id:"trendQuery",label:"Nicho ou Tópico:",value:o,onChange:a=>g(a.target.value),placeholder:"Ex: 'Marketing digital para restaurantes'",className:"mb-0"}),e.jsxs("div",{className:"relative",children:[e.jsxs("label",{className:"block text-sm font-medium text-title mb-1.5 flex justify-between",children:[e.jsx("span",{children:"Local (Opcional)"}),u==="success"&&!n&&e.jsxs("span",{className:"text-xs text-success flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"})," Usando GPS"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"trendCity",type:"text",className:`block w-full px-3 py-2.5 bg-surface border rounded-lg shadow-sm text-body placeholder-muted transition-colors focus:outline-none sm:text-sm ${u==="success"&&!n?"border-success/50 ring-1 ring-success/20 pl-9":"border-gray-200 focus:border-primary focus:ring-1 focus:ring-primary"}`,value:n,onChange:a=>p(a.target.value),placeholder:u==="success"?"GPS Ativo (Digite para alterar)":"Digite cidade ou país..."}),u==="success"&&!n&&e.jsx(_,{className:"absolute left-3 top-2.5 w-4 h-4 text-success"}),e.jsx("button",{onClick:C,className:`absolute right-2 top-2 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${u==="success"?"text-success":"text-muted"}`,title:u==="success"?"GPS Ativo":"Ativar GPS",children:u==="pending"?e.jsx(ne,{className:"w-4 h-4"}):e.jsx(_,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsx(x,{onClick:z,isLoading:$,variant:"primary",className:"w-full sm:w-auto",children:$?"Buscando Tendências...":"Buscar Tendências"}),Z&&e.jsx(x,{onClick:J,variant:"outline",className:"w-full sm:w-auto",children:"Limpar Busca"})]})]}),S.length>0&&e.jsxs("div",{className:"bg-surface p-6 rounded-xl shadow-card border border-gray-100 dark:border-gray-800",children:[e.jsx("h3",{className:"text-xl font-semibold text-title mb-5",children:"Resultados de Tendências"}),e.jsx("div",{className:"space-y-8",children:S.map(a=>e.jsxs("div",{className:"p-5 border border-gray-200 dark:border-gray-700 rounded-lg hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-title",children:a.query}),e.jsxs("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${a.score>70?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300":a.score>40?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300"}`,children:["Score Viral: ",a.score]})]}),e.jsx("div",{className:"mb-4",children:K(a.data,a.groundingMetadata)}),a.sources&&a.sources.length>0&&e.jsxs("div",{className:"mt-3 bg-background/50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm font-semibold text-muted mb-2",children:"Fontes:"}),e.jsx("ol",{className:"list-decimal list-inside text-sm text-primary space-y-1",children:a.sources.map((s,i)=>e.jsx("li",{children:e.jsx("a",{href:s.uri,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",children:s.title||s.uri})},i))})]}),A[a.id]&&e.jsxs("div",{className:"mt-4 mb-4 p-4 bg-primary/5 border border-primary/20 rounded-md animate-in fade-in",children:[e.jsxs("h5",{className:"text-sm font-bold text-primary mb-1 flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Ideia de Conteúdo"]}),e.jsxs("p",{className:"text-sm text-body italic",children:['"',A[a.id],'"']})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 mt-6",children:[e.jsx(x,{onClick:()=>D(a),isLoading:R===a.id,variant:"outline",className:"w-full sm:w-auto",children:"Gerar Ideia de Conteúdo"}),e.jsx(x,{onClick:()=>H(a),variant:"primary",className:"w-full sm:w-auto",children:"Criar Conteúdo da Tendência"}),e.jsx(x,{onClick:()=>O(a),variant:"secondary",className:"w-full sm:w-auto",children:"Adicionar ao Calendário"})]})]},a.id))})]})]})};export{me as default};
