import{S as i,L as S,J as G,H as I,T as A,U as $,G as U,V as F,_ as e,b as j,t as D,E as L,X as q,Z as O}from"./index-Di1jv5f6.js";import{m as P}from"./Textarea-gaIhsF-Z-OB2gT--i.js";import{n as k}from"./Input-CRT_4c0B-CcXoGhNA.js";import{M as _,D as B}from"./MediaActionsToolbar-DcojfTTc-4KYaUHh3.js";import{s as J}from"./SpeakerWaveIcon-_A4BRNIH-DnrAJ2Xb.js";import{m as V}from"./firestoreService-BE71X2i2-C74a6-GV.js";import"./useMediaActions-DZ7A1mgc-VCjv--Wh.js";const z=({text:m})=>{const[w,p]=i.useState(!1),[h,l]=i.useState(null),{addToast:b}=G(),s=i.useRef(null);i.useEffect(()=>()=>{h&&URL.revokeObjectURL(h)},[h]);const N=r=>{const o=r.numberOfChannels,g=r.length*o*2+44,f=new ArrayBuffer(g),n=new DataView(f);let d=0;const x=c=>{n.setUint16(d,c,!0),d+=2},t=c=>{n.setUint32(d,c,!0),d+=4};t(1179011410),t(36+r.length*2*o),t(1163280727),t(544501094),t(16),x(1),x(o),t(r.sampleRate),t(r.sampleRate*2*o),x(o*2),x(16),t(1635017060),t(r.length*2*o);let v=44;for(let c=0;c<r.length;c++)for(let y=0;y<o;y++){const a=Math.max(-1,Math.min(1,r.getChannelData(y)[c]));n.setInt16(v,a<0?a*32768:a*32767,!0),v+=2}return new Blob([n],{type:"audio/wav"})},u=i.useCallback(async()=>{if(m){p(!0),l(null);try{const r=await L(m,"Kore");if(!r)throw new Error("Nenhum áudio foi gerado.");const o=q(r),g=new(window.AudioContext||window.webkitAudioContext)({sampleRate:24e3}),f=await O(o,g,24e3,1),n=N(f),d=URL.createObjectURL(n);l(d),b({type:"success",message:"Narração gerada."})}catch(r){console.error("Voiceover generation failed:",r),b({type:"error",message:`Falha ao gerar narração: ${r instanceof Error?r.message:"Erro desconhecido"}`})}finally{p(!1)}}},[m,b]);return e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[e.jsxs(j,{onClick:u,isLoading:w,variant:"outline",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Gerar Narração"]}),h&&!w&&e.jsx("audio",{ref:s,controls:!0,src:h,className:"w-full mt-3 h-10"})]})},M=["Instagram","Facebook","TikTok","Google","Pinterest"],ee=()=>{const[m,w]=i.useState(""),[p,h]=i.useState(""),[l,b]=i.useState("Instagram"),[s,N]=i.useState(null),[u,r]=i.useState(S),[o,g]=i.useState(!1),[f,n]=i.useState(""),[d,x]=i.useState(""),{addToast:t}=G(),v="mock-user-123",c=i.useCallback(async()=>{if(!m.trim()||!p.trim()){t({type:"warning",title:"Campos Vazios",message:"Por favor, preencha a descrição e o público-alvo."});return}g(!0),N(null),r(S),n(""),x("");try{const a=`Generate a compelling ad for ${l}.
      Product: "${m}".
      Target Audience: "${p}".
      Provide a headline, ad copy, and a visual description for an image/video creative.
      Return the output as a JSON object with 'headline', 'copy', and 'visual_description' keys.`,R=await I(a,{model:$,responseMimeType:"application/json",responseSchema:{type:A.OBJECT,properties:{headline:{type:A.STRING},copy:{type:A.STRING},visual_description:{type:A.STRING}},required:["headline","copy","visual_description"]}}),C=JSON.parse(R),E={id:`ad-${Date.now()}`,userId:v,platform:l,headline:C.headline,copy:C.copy,createdAt:new Date().toISOString()};N(E);const T=await U(C.visual_description,{model:F,aspectRatio:"1:1",imageSize:"1K"});r(T.imageUrl||S),E.media_url=T.imageUrl||void 0,t({type:"success",title:"Anúncio Criado",message:"Anúncio gerado com sucesso."})}catch(a){console.error("Error generating ad:",a),t({type:"error",title:"Erro",message:`Falha ao gerar anúncio: ${a instanceof Error?a.message:String(a)}`})}finally{g(!1)}},[m,p,l,v,t]),y=i.useCallback(async()=>{if(!s){t({type:"warning",message:"Nenhum anúncio para salvar."});return}g(!0);try{const a=await V(s);t({type:"success",title:"Salvo",message:`Anúncio para "${a.platform}" salvo com sucesso!`})}catch(a){console.error("Error saving ad:",a),t({type:"error",title:"Erro ao Salvar",message:"Falha ao salvar o anúncio."})}finally{g(!1)}},[s,t]);return e.jsxs("div",{className:"container mx-auto py-8 lg:py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-textdark mb-8",children:"Estúdio de Anúncios"}),e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold text-textlight mb-5",children:"Detalhes do Anúncio"}),e.jsx(P,{id:"productDescription",label:"Descrição do Produto/Serviço:",value:m,onChange:a=>w(a.target.value),rows:4,placeholder:"Ex: 'Um novo software de gestão de projetos com IA para pequenas e médias empresas que otimiza tarefas e comunicação.'"}),e.jsx(k,{id:"targetAudience",label:"Público-alvo:",value:p,onChange:a=>h(a.target.value),placeholder:"Ex: 'Empreendedores, gerentes de equipe, freelancers que buscam eficiência.'"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"platform",className:"block text-sm font-medium text-textlight mb-1",children:"Plataforma:"}),e.jsx("select",{id:"platform",value:l,onChange:a=>b(a.target.value),className:"block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm bg-lightbg text-textdark focus:outline-none focus:ring-2 focus:ring-neonGreen focus:border-neonGreen focus:ring-offset-2 focus:ring-offset-lightbg sm:text-sm",children:M.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(j,{onClick:c,isLoading:o&&!s,variant:"primary",className:"w-full md:w-auto mt-4",children:o&&!s?"Gerando Anúncio...":"Gerar Anúncio"})]}),s&&e.jsxs("div",{className:"bg-lightbg p-6 rounded-lg shadow-sm border border-gray-800 animate-slide-in-from-bottom duration-500",children:[e.jsxs("h3",{className:"text-xl font-semibold text-textlight mb-5",children:["Anúncio Gerado para ",s.platform]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Título:"}),e.jsx("p",{className:"text-textdark text-xl font-medium mb-4",children:s.headline}),e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Texto:"}),e.jsx("div",{className:"prose max-w-none text-textlight leading-relaxed bg-darkbg p-4 rounded-md h-auto min-h-[150px]",style:{whiteSpace:"pre-wrap"},children:s.copy}),e.jsx(z,{text:s.copy}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(j,{variant:"secondary",onClick:()=>t({type:"info",message:"Funcionalidade em desenvolvimento."}),children:"Gerar Variações"}),e.jsx(j,{variant:"outline",onClick:()=>t({type:"info",message:"Funcionalidade em desenvolvimento."}),children:"Editar"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-3",children:"Criativo Visual:"}),e.jsx("div",{className:"w-full aspect-square bg-gray-900 rounded-md flex items-center justify-center overflow-hidden border border-gray-700",children:o&&!u?e.jsx(D,{}):e.jsx("img",{src:u,alt:"Generated ad creative",className:"w-full h-full object-contain"})}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx(_,{mediaUrl:u,fileName:`vitrinex-ad-${l}.png`,shareTitle:`Confira este anúncio para ${l}!`,shareText:s.copy}),e.jsx(j,{onClick:y,variant:"primary",isLoading:o,disabled:!s,className:"w-full sm:w-auto",children:o&&s?"Salvando Anúncio...":"Salvar Anúncio"})]})]})]}),e.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-800",children:[e.jsx("h4",{className:"text-lg font-semibold text-textlight mb-4",children:"Salvar Criativo na Biblioteca"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsx(k,{id:"adSaveName",label:"Nome do Arquivo",value:f,onChange:a=>n(a.target.value),placeholder:"Ex: Anúncio Black Friday"}),e.jsx(k,{id:"adSaveTags",label:"Tags",value:d,onChange:a=>x(a.target.value),placeholder:"Ex: ad, instagram, black friday"})]}),e.jsx(B,{content:u,type:"image",userId:v,initialName:f||`Anúncio ${s.platform}`,tags:d.split(",").map(a=>a.trim()).filter(Boolean),label:"Salvar Apenas Criativo (Imagem)",variant:"secondary",disabled:!u||u===S,className:"w-full sm:w-auto"})]})]})]})};export{ee as default};
